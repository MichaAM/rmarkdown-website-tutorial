---
title: "school-learning environment"
---

```{r include=FALSE}
setwd("C:/Users/user/Desktop/Aklim analysis")
```

```{r include=FALSE}
library(sandwich)
library(lmtest)
library(stargazer)
library(estimatr)
library(texreg)
library(tidyverse)
library(plm)
library(lfe)
library(estimatr)
```

## Introduction
In this analysis there are 3 models for each school-learning environment analysis:   
1. Model 1: General DiD with clustered SE at school level   
2. Model 2: DiD with school and year fixed effects   
3. Model 3: DiD with school and year fixed effects and additional variables   


```{r include=FALSE}
getwd()
final <- read.csv("final.csv")
```

## Dependent variables description in the following analysis: 
Questions 1-4 : The choices in the questionnaire presented 3 possible answers: 1- Often, 2- Rarely or 3- Not at all.
I created a new dummy variable that takes "1" for "often" and "0" for rest. 

Questions 4-8 : The choices in the questionnaire presented 3 possible answers: 1- Yes, 2- No or 3- Don't Know
Second, I created a new dummy variable that takes "1" for "Yes" and "0" for rest. 

Questions 9-10 : The 2 last question are indicators for General satisfaction from school and Student misbehavior in class.
For the General satisfaction indicator I averaged 2 the answers of the following questions: 
**Q: "I feel good at school"** 
**Q: "I love being in school"**

For the Student misbehavior in class indicator I averaged 2 the answers of the following questions: 
**Q: "The students in my class treat teachers with respect"** 
**Q: "Students often make noise and commotion in the classroom and impair the learning of other students"**
**Q: "In my class there are students who are rude to teachers"** 
**Q: "Teachers have to wait a long time at the beginning of the lesson until the students stop making noise"** 

The choices in the questionnaire presented 5 possible answers: 1- Agree to 5- Disagree

I standardized the answers grad using z score with yearly average. 


# **Analysis by sector**

```{r include=FALSE}
final$CODE_MIGZAR  <- ifelse(final$CODE_MIGZAR == "1", "0", "1")

final_jew <- final %>% 
  filter(CODE_MIGZAR == "0")

final_arb <- final %>% 
  filter(CODE_MIGZAR == "1")
```


### 1. Using computers in language classes 

**Q: "Do you use a computer during language lessons?"**

DiD regression with clustered SE - Jewish sector

```{r}

didreg.lang.jew <- lm_robust(Lang ~ treat + after + did,
                            data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.lang.jew.fe <- lm_robust(Lang ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                             data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.lang.jew.fe.vars <- lm_robust(Lang ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                     SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

```

DiD regression with clustered SE - Arab sector

```{r}
didreg.lang.arb <- lm_robust(Lang ~ treat + after + did,
                             data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

didreg.lang.arb.fe <- lm_robust(Lang ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

didreg.lang.arb.fe.vars <- lm_robust(Lang ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                       SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                     data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

```

Combined results table 

```{r}
screenreg(list(didreg.lang.jew, didreg.lang.jew.fe, didreg.lang.jew.fe.vars, didreg.lang.arb, didreg.lang.arb.fe, didreg.lang.arb.fe.vars),
          custom.header = list("Jewish sector" = 1:3,  "Arab sector" = 4:6), include.ci = F, stars = c(.1, .05, .01), 
          custom.coef.names = c("Intercept", "Treat", "After", "Reform DiD", "Male indicator", "Mother's years of education", "Father's years of education",
                                "Number of siblings", "Native indicator", "SES index", "Class size", "School age"),
          digits = 3, custom.model.names = c("Model 1", "Model 2", "Model 3", "Model 1", "Model 2", "Model 3"))
```


### 2. Using computers in English classes 

**Q: "Do you use a computer during English lessons?"**


DiD regression with clustered SE - Jewish sector

```{r}

didreg.English.jew <- lm_robust(English ~ treat + after + did,
                             data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.English.jew.fe <- lm_robust(English ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.English.jew.fe.vars <- lm_robust(English ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                       SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                     data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

```

DiD regression with clustered SE - Arab sector

```{r}
didreg.English.arb <- lm_robust(English ~ treat + after + did,
                             data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

didreg.English.arb.fe <- lm_robust(English ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

didreg.English.arb.fe.vars <- lm_robust(English ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                       SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                     data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

```

Combined results table 

```{r}

screenreg(list(didreg.English.jew, didreg.English.jew.fe, didreg.English.jew.fe.vars, didreg.English.arb, didreg.English.arb.fe, didreg.English.arb.fe.vars),
          custom.header = list("Jewish sector" = 1:3,  "Arab sector" = 4:6), include.ci = F, stars = c(.1, .05, .01), 
          custom.coef.names = c("Intercept", "Treat", "After", "Reform DiD", "Male indicator", "Mother's years of education", "Father's years of education",
                                "Number of siblings", "Native indicator", "SES index", "Class size", "School age"),
          digits = 3, custom.model.names = c("Model 1", "Model 2", "Model 3", "Model 1", "Model 2", "Model 3"))
```

### 3. Using computers in Math classes 

**Q: "Do you use a computer during Math lessons?"**

DiD regression with clustered SE - Jewish sector

```{r}

didreg.Math.jew <- lm_robust(Math ~ treat + after + did,
                                data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.Math.jew.fe <- lm_robust(Math ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                   data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.Math.jew.fe.vars <- lm_robust(Math ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                          SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                        data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

```

DiD regression with clustered SE - Arab sector

```{r}
didreg.Math.arb <- lm_robust(Math ~ treat + after + did,
                                data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

didreg.Math.arb.fe <- lm_robust(Math ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                   data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

didreg.Math.arb.fe.vars <- lm_robust(Math ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                        SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                        data = final_arb, clusters = CODE_MOSAD, se_type = "stata")
```

Combined results table 

```{r}

screenreg(list(didreg.Math.jew, didreg.Math.jew.fe, didreg.Math.jew.fe.vars, didreg.Math.arb, didreg.Math.arb.fe, didreg.Math.arb.fe.vars),
          custom.header = list("Jewish sector" = 1:3,  "Arab sector" = 4:6), include.ci = F, stars = c(.1, .05, .01), 
          custom.coef.names = c("Intercept", "Treat", "After", "Reform DiD", "Male indicator", "Mother's years of education", "Father's years of education",
                                "Number of siblings", "Native indicator", "SES index", "Class size", "School age"),
          digits = 3, custom.model.names = c("Model 1", "Model 2", "Model 3", "Model 1", "Model 2", "Model 3"))
```

### 4. Using computers in Tech classes 

**Q: "Do you use a computer during Tech or Science lessons?"**

DiD regression with clustered SE - Jewish sector

```{r}

didreg.Tech.jew <- lm_robust(Tech ~ treat + after + did,
                             data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.Tech.jew.fe <- lm_robust(Tech ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.Tech.jew.fe.vars <- lm_robust(Tech ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                       SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                     data = final_jew, clusters = CODE_MOSAD, se_type = "stata")


```

DiD regression with clustered SE - Arab sector

```{r}
didreg.Tech.arb <- lm_robust(Tech ~ treat + after + did,
                             data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

didreg.Tech.arb.fe <- lm_robust(Tech ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

didreg.Tech.arb.fe.vars <- lm_robust(Tech ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                       SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                     data = final_arb, clusters = CODE_MOSAD, se_type = "stata")
```

Combined results table 

```{r}

screenreg(list(didreg.Tech.jew, didreg.Tech.jew.fe, didreg.Tech.jew.fe.vars, didreg.Tech.arb, didreg.Tech.arb.fe, didreg.Tech.arb.fe.vars),
          custom.header = list("Jewish sector" = 1:3,  "Arab sector" = 4:6), include.ci = F, stars = c(.1, .05, .01), 
          custom.coef.names = c("Intercept", "Treat", "After", "Reform DiD", "Male indicator", "Mother's years of education", "Father's years of education",
                                "Number of siblings", "Native indicator", "SES index", "Class size", "School age"),
          digits = 3, custom.model.names = c("Model 1", "Model 2", "Model 3", "Model 1", "Model 2", "Model 3"))
```


### 5. School's Website awareness 

**Q: "Does the school have an internet site?"**

DiD regression with clustered SE - Jewish sector

```{r}

didreg.website.jew <- lm_robust(dummy_yes_no_website ~ treat + after + did,
                             data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.website.jew.fe <- lm_robust(dummy_yes_no_website ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.website.jew.fe.vars <- lm_robust(dummy_yes_no_website ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                       SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                     data = final_jew, clusters = CODE_MOSAD, se_type = "stata")


```

DiD regression with clustered SE - Arab sector

```{r}
didreg.website.arb <- lm_robust(dummy_yes_no_website ~ treat + after + did,
                             data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

didreg.website.arb.fe <- lm_robust(dummy_yes_no_website ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

didreg.website.arb.fe.vars <- lm_robust(dummy_yes_no_website ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                       SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                     data = final_arb, clusters = CODE_MOSAD, se_type = "stata")
```

Combined results table 

```{r}

screenreg(list(didreg.website.jew, didreg.website.jew.fe, didreg.website.jew.fe.vars, didreg.website.arb, didreg.website.arb.fe, didreg.website.arb.fe.vars),
          custom.header = list("Jewish sector" = 1:3,  "Arab sector" = 4:6), include.ci = F, stars = c(.1, .05, .01), 
          custom.coef.names = c("Intercept", "Treat", "After", "Reform DiD", "Male indicator", "Mother's years of education", "Father's years of education",
                                "Number of siblings", "Native indicator", "SES index", "Class size", "School age"),
          digits = 3, custom.model.names = c("Model 1", "Model 2", "Model 3", "Model 1", "Model 2", "Model 3"))
```


### 6. School's Website Download  

**Q: "Have you downloaded study materials, such as homework, summaries, tests, from the school website?"**

DiD regression with clustered SE - Jewish sector

```{r}

didreg.download.jew <- lm_robust(dummy_yes_no_download ~ treat + after + did,
                                data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.download.jew.fe <- lm_robust(dummy_yes_no_download ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                   data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.download.jew.fe.vars <- lm_robust(dummy_yes_no_download ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                          SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                        data = final_jew, clusters = CODE_MOSAD, se_type = "stata")


```

DiD regression with clustered SE - Arab sector

```{r}
didreg.download.arb <- lm_robust(dummy_yes_no_download ~ treat + after + did,
                                data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

didreg.download.arb.fe <- lm_robust(dummy_yes_no_download ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                   data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

didreg.download.arb.fe.vars <- lm_robust(dummy_yes_no_download ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                          SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                        data = final_arb, clusters = CODE_MOSAD, se_type = "stata")
```

Combined results table 

```{r}
screenreg(list(didreg.download.jew, didreg.download.jew.fe, didreg.download.jew.fe.vars, didreg.download.arb, didreg.download.arb.fe, didreg.download.arb.fe.vars),
          custom.header = list("Jewish sector" = 1:3,  "Arab sector" = 4:6), include.ci = F, stars = c(.1, .05, .01), 
          custom.coef.names = c("Intercept", "Treat", "After", "Reform DiD", "Male indicator", "Mother's years of education", "Father's years of education",
                                "Number of siblings", "Native indicator", "SES index", "Class size", "School age"),
          digits = 3, custom.model.names = c("Model 1", "Model 2", "Model 3", "Model 1", "Model 2", "Model 3"))
```

### 7. School's Website Upload  

**Q: "Have you uploaded study materials, such as homework, summaries, tests, to the school website?"**

DiD regression with clustered SE - Jewish sector

```{r}

didreg.upload.jew <- lm_robust(dummy_yes_no_upload ~ treat + after + did,
                                 data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.upload.jew.fe <- lm_robust(dummy_yes_no_upload ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                    data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.upload.jew.fe.vars <- lm_robust(dummy_yes_no_upload ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                           SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                         data = final_jew, clusters = CODE_MOSAD, se_type = "stata")


```

DiD regression with clustered SE - Arab sector

```{r}
didreg.upload.arb <- lm_robust(dummy_yes_no_upload ~ treat + after + did,
                                 data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

didreg.upload.arb.fe <- lm_robust(dummy_yes_no_upload ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                    data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

didreg.upload.arb.fe.vars <- lm_robust(dummy_yes_no_upload ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                           SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                         data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

```

Combined results table 

```{r}
screenreg(list(didreg.upload.jew, didreg.upload.jew.fe, didreg.upload.jew.fe.vars, didreg.upload.arb, didreg.upload.arb.fe, didreg.upload.arb.fe.vars),
          custom.header = list("Jewish sector" = 1:3,  "Arab sector" = 4:6), include.ci = F, stars = c(.1, .05, .01), 
          custom.coef.names = c("Intercept", "Treat", "After", "Reform DiD", "Male indicator", "Mother's years of education", "Father's years of education",
                                "Number of siblings", "Native indicator", "SES index", "Class size", "School age"),
          digits = 3, custom.model.names = c("Model 1", "Model 2", "Model 3", "Model 1", "Model 2", "Model 3"))

```

### 8. School's/class's forum  

**Q: "Have you participated in online school discussion groups on academic topics?"**

DiD regression with clustered SE - Jewish sector

```{r}

didreg.forum.jew <- lm_robust(dummy_yes_no_forum ~ treat + after + did,
                               data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.forum.jew.fe <- lm_robust(dummy_yes_no_forum ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                  data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.forum.jew.fe.vars <- lm_robust(dummy_yes_no_forum ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                         SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                       data = final_jew, clusters = CODE_MOSAD, se_type = "stata")


```

DiD regression with clustered SE - Arab sector

```{r}
didreg.forum.arb <- lm_robust(dummy_yes_no_forum ~ treat + after + did,
                               data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

didreg.forum.arb.fe <- lm_robust(dummy_yes_no_forum ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                  data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

didreg.forum.arb.fe.vars <- lm_robust(dummy_yes_no_forum ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                         SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                       data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

```

Combined results table 

```{r}
screenreg(list(didreg.forum.jew, didreg.forum.jew.fe, didreg.forum.jew.fe.vars, didreg.forum.arb, didreg.forum.arb.fe, didreg.forum.arb.fe.vars),
          custom.header = list("Jewish sector" = 1:3,  "Arab sector" = 4:6), include.ci = F, stars = c(.1, .05, .01), 
          custom.coef.names = c("Intercept", "Treat", "After", "Reform DiD", "Male indicator", "Mother's years of education", "Father's years of education",
                                "Number of siblings", "Native indicator", "SES index", "Class size", "School age"),
          digits = 3, custom.model.names = c("Model 1", "Model 2", "Model 3", "Model 1", "Model 2", "Model 3"))

```


### 9. General school satisfaction Indicator   

The General school satisfaction Indicator consists of the average of the answers to the following questions: 
**Q: "I feel good at school"** 
**Q: "I love being in school"**



DiD regression with clustered SE - Jewish sector

```{r}

didreg.feel.jew <- lm_robust(feel_index ~ treat + after + did,
                              data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.feel.jew.fe <- lm_robust(feel_index ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                 data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.feel.jew.fe.vars <- lm_robust(feel_index ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                        SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                      data = final_jew, clusters = CODE_MOSAD, se_type = "stata")


```

DiD regression with clustered SE - Arab sector

```{r}
didreg.feel.arb <- lm_robust(feel_index ~ treat + after + did,
                              data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

didreg.feel.arb.fe <- lm_robust(feel_index ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                 data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

didreg.feel.arb.fe.vars <- lm_robust(feel_index ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                        SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                      data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

```

Combined results table 

```{r}
screenreg(list(didreg.feel.jew, didreg.feel.jew.fe, didreg.feel.jew.fe.vars, didreg.feel.arb, didreg.feel.arb.fe, didreg.feel.arb.fe.vars),
          custom.header = list("Jewish sector" = 1:3,  "Arab sector" = 4:6), include.ci = F, stars = c(.1, .05, .01), 
          custom.coef.names = c("Intercept", "Treat", "After", "Reform DiD", "Male indicator", "Mother's years of education", "Father's years of education",
                                "Number of siblings", "Native indicator", "SES index", "Class size", "School age"),
          digits = 3, custom.model.names = c("Model 1", "Model 2", "Model 3", "Model 1", "Model 2", "Model 3"))

```

### 10. Student misbehavior in class Indicator   

The Student misbehavior in class Indicator consists of the average of the answers to the following questions: 
**Q: "The students in my class treat teachers with respect"** 
**Q: "Students often make noise and commotion in the classroom and impair the learning of other students"**
**Q: "In my class there are students who are rude to teachers"** 
**Q: "Teachers have to wait a long time at the beginning of the lesson until the students stop making noise"** 



DiD regression with clustered SE - Jewish sector

```{r}

didreg.behave.jew <- lm_robust(behave_index ~ treat + after + did,
                             data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.behave.jew.fe <- lm_robust(behave_index ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                data = final_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.behave.jew.fe.vars <- lm_robust(behave_index ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                       SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                     data = final_jew, clusters = CODE_MOSAD, se_type = "stata")


```

DiD regression with clustered SE - Arab sector

```{r}
didreg.behave.arb <- lm_robust(behave_index ~ treat + after + did,
                             data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

didreg.behave.arb.fe <- lm_robust(behave_index ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                data = final_arb, clusters = CODE_MOSAD, se_type = "stata")

didreg.behave.arb.fe.vars <- lm_robust(behave_index ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                       SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                     data = final_arb, clusters = CODE_MOSAD, se_type = "stata")
```

Combined results table 

```{r}

screenreg(list(didreg.behave.jew, didreg.behave.jew.fe, didreg.behave.jew.fe.vars, didreg.behave.arb, didreg.behave.arb.fe, didreg.behave.arb.fe.vars),
          custom.header = list("Jewish sector" = 1:3,  "Arab sector" = 4:6), include.ci = F, stars = c(.1, .05, .01), 
          custom.coef.names = c("Intercept", "Treat", "After", "Reform DiD", "Male indicator", "Mother's years of education", "Father's years of education",
                                "Number of siblings", "Native indicator", "SES index", "Class size", "School age"),
          digits = 3, custom.model.names = c("Model 1", "Model 2", "Model 3", "Model 1", "Model 2", "Model 3"))
```

# **Analysis by regions per sectors** 

Split by region - Periphery vs Rest 
```{r}
final_peri <- final %>%
  filter(CODE_MACHOZ_GEOGRAFI == "2" | CODE_MACHOZ_GEOGRAFI == "6")

final_not_periphery <- final %>%
  filter(CODE_MACHOZ_GEOGRAFI != "2" & CODE_MACHOZ_GEOGRAFI != "6")

```


Analysis of periphery region 

Split each Periphery vs Rest by sector
```{r}
final_peri_jew <- final_peri %>%
  filter(CODE_MIGZAR == "0")

final_peri_arb <- final_peri %>%
  filter(CODE_MIGZAR == "1")

```


Check ratio of treated vs untreated for each region

Periphery: ratio of Arab sector vs Jewish sector for periphery region
```{r}
peri_sector_treat_ratio_table <- table(final_peri$CODE_MIGZAR, final_peri$treat)
row.names(peri_sector_treat_ratio_table) <- c("Jewish", "Arab")
colnames(peri_sector_treat_ratio_table) <- c("Treated", "Untreated")
peri_sector_treat_ratio_table
```
* Only 143 classes out of 1812 from the periphery did not take part in the ICT program

Not periphery: ratio of Arab sector vs Jewish sector for not periphery region
```{r}
not_peri_sector_treat_ratio_table <- table(final_not_periphery$CODE_MIGZAR, final_not_periphery$treat)
row.names(not_peri_sector_treat_ratio_table) <- c("Jewish", "Arab")
colnames(not_peri_sector_treat_ratio_table) <- c("Treated", "Untreated")
not_peri_sector_treat_ratio_table
```
* Only 51 classes out of 412 Arab schools out of the periphery did not take part in the ICT program 

# Not periphery schools learning environment analysis - **Jewish sectore only** 

Split not_periphery by sectors 
```{r}
final_not_peri_jew <- final_not_periphery %>%
  filter(CODE_MIGZAR == "0")

final_not_peri_arb <- final_not_periphery %>%
  filter(CODE_MIGZAR == "1")
```

### 1. Using computers in language classes 

**Q: "Do you use a computer during language lessons?"**

DiD regression with clustered SE - Jewish sector

```{r}

didreg.lang.jew.not.peri <- lm_robust(Lang ~ treat + after + did,
                            data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.lang.jew.fe.not.peri <- lm_robust(Lang ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                             data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.lang.jew.fe.vars.not.peri <- lm_robust(Lang ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                     SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

```


Results table 

```{r}
screenreg(list(didreg.lang.jew.not.peri, didreg.lang.jew.fe.not.peri, didreg.lang.jew.fe.vars.not.peri),
          custom.header = list("Jewish sector" = 1:3), include.ci = F, stars = c(.1, .05, .01), 
          custom.coef.names = c("Intercept", "Treat", "After", "Reform DiD", "Male indicator", "Mother's years of education", "Father's years of education",
                                "Number of siblings", "Native indicator", "SES index", "Class size", "School age"),
          digits = 3, custom.model.names = c("Model 1", "Model 2", "Model 3"))
```


### 2. Using computers in English classes 

**Q: "Do you use a computer during English lessons?"**


DiD regression with clustered SE - Jewish sector

```{r}

didreg.English.jew.not.peri <- lm_robust(English ~ treat + after + did,
                            data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.English.jew.fe.not.peri <- lm_robust(English ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                             data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.English.jew.fe.vars.not.peri <- lm_robust(English ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                     SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

```

Results table 

```{r}

screenreg(list(didreg.English.jew.not.peri, didreg.English.jew.fe.not.peri, didreg.English.jew.fe.vars.not.peri),
          custom.header = list("Jewish sector" = 1:3), include.ci = F, stars = c(.1, .05, .01), 
          custom.coef.names = c("Intercept", "Treat", "After", "Reform DiD", "Male indicator", "Mother's years of education", "Father's years of education",
                                "Number of siblings", "Native indicator", "SES index", "Class size", "School age"),
          digits = 3, custom.model.names = c("Model 1", "Model 2", "Model 3"))
```

### 3. Using computers in Math classes 

**Q: "Do you use a computer during Math lessons?"**

DiD regression with clustered SE - Jewish sector

```{r}

didreg.Math.jew.not.peri <- lm_robust(Math ~ treat + after + did,
                            data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.Math.jew.fe.not.peri <- lm_robust(Math ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                             data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.Math.jew.fe.vars.not.peri <- lm_robust(Math ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                     SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

```

Results table 

```{r}

screenreg(list(didreg.Math.jew.not.peri, didreg.Math.jew.fe.not.peri, didreg.Math.jew.fe.vars.not.peri),
          custom.header = list("Jewish sector" = 1:3), include.ci = F, stars = c(.1, .05, .01), 
          custom.coef.names = c("Intercept", "Treat", "After", "Reform DiD", "Male indicator", "Mother's years of education", "Father's years of education",
                                "Number of siblings", "Native indicator", "SES index", "Class size", "School age"),
          digits = 3, custom.model.names = c("Model 1", "Model 2", "Model 3"))
```
### 4. Using computers in Tech classes 

**Q: "Do you use a computer during Tech or Science lessons?"**

DiD regression with clustered SE - Jewish sector

```{r}

didreg.Tech.jew.not.peri <- lm_robust(Tech ~ treat + after + did,
                            data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.Tech.jew.fe.not.peri <- lm_robust(Tech ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                             data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.Tech.jew.fe.vars.not.peri <- lm_robust(Tech ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                     SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

```

Results table 

```{r}

screenreg(list(didreg.Tech.jew.not.peri, didreg.Tech.jew.fe.not.peri, didreg.Tech.jew.fe.vars.not.peri),
          custom.header = list("Jewish sector" = 1:3), include.ci = F, stars = c(.1, .05, .01), 
          custom.coef.names = c("Intercept", "Treat", "After", "Reform DiD", "Male indicator", "Mother's years of education", "Father's years of education",
                                "Number of siblings", "Native indicator", "SES index", "Class size", "School age"),
          digits = 3, custom.model.names = c("Model 1", "Model 2", "Model 3"))
```

### 5. School's Website awareness 

**Q: "Does the school have an internet site?"**

DiD regression with clustered SE - Jewish sector

```{r}

didreg.website.jew.not.peri <- lm_robust(dummy_yes_no_website ~ treat + after + did,
                            data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.website.jew.fe.not.peri <- lm_robust(dummy_yes_no_website ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                             data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.website.jew.fe.vars.not.peri <- lm_robust(dummy_yes_no_website ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                     SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

```

Results table 

```{r}

screenreg(list(didreg.website.jew.not.peri, didreg.website.jew.fe.not.peri, didreg.website.jew.fe.vars.not.peri),
          custom.header = list("Jewish sector" = 1:3), include.ci = F, stars = c(.1, .05, .01), 
          custom.coef.names = c("Intercept", "Treat", "After", "Reform DiD", "Male indicator", "Mother's years of education", "Father's years of education",
                                "Number of siblings", "Native indicator", "SES index", "Class size", "School age"),
          digits = 3, custom.model.names = c("Model 1", "Model 2", "Model 3"))
```

### 6. School's Website Download  

**Q: "Have you downloaded study materials, such as homework, summaries, tests, from the school website?"**

DiD regression with clustered SE - Jewish sector

```{r}

didreg.Download.jew.not.peri <- lm_robust(dummy_yes_no_download ~ treat + after + did,
                            data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.Download.jew.fe.not.peri <- lm_robust(dummy_yes_no_download ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                             data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.Download.jew.fe.vars.not.peri <- lm_robust(dummy_yes_no_download ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                     SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

```

Results table 

```{r}

screenreg(list(didreg.Download.jew.not.peri, didreg.Download.jew.fe.not.peri, didreg.Download.jew.fe.vars.not.peri),
          custom.header = list("Jewish sector" = 1:3), include.ci = F, stars = c(.1, .05, .01), 
          custom.coef.names = c("Intercept", "Treat", "After", "Reform DiD", "Male indicator", "Mother's years of education", "Father's years of education",
                                "Number of siblings", "Native indicator", "SES index", "Class size", "School age"),
          digits = 3, custom.model.names = c("Model 1", "Model 2", "Model 3"))
```


### 7. School's Website Upload  

**Q: "Have you uploaded study materials, such as homework, summaries, tests, to the school website?"**

DiD regression with clustered SE - Jewish sector

```{r}

didreg.upload.jew.not.peri <- lm_robust(dummy_yes_no_upload ~ treat + after + did,
                            data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.upload.jew.fe.not.peri <- lm_robust(dummy_yes_no_upload ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                             data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.upload.jew.fe.vars.not.peri <- lm_robust(dummy_yes_no_upload ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                     SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

```

Results table 

```{r}

screenreg(list(didreg.upload.jew.not.peri, didreg.upload.jew.fe.not.peri, didreg.upload.jew.fe.vars.not.peri),
          custom.header = list("Jewish sector" = 1:3), include.ci = F, stars = c(.1, .05, .01), 
          custom.coef.names = c("Intercept", "Treat", "After", "Reform DiD", "Male indicator", "Mother's years of education", "Father's years of education",
                                "Number of siblings", "Native indicator", "SES index", "Class size", "School age"),
          digits = 3, custom.model.names = c("Model 1", "Model 2", "Model 3"))
```
### 8. School's/class's forum  

**Q: "Have you participated in online school discussion groups on academic topics?"**

DiD regression with clustered SE - Jewish sector

```{r}

didreg.forum.jew.not.peri <- lm_robust(dummy_yes_no_forum ~ treat + after + did,
                            data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.forum.jew.fe.not.peri <- lm_robust(dummy_yes_no_forum ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                             data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.forum.jew.fe.vars.not.peri <- lm_robust(dummy_yes_no_forum ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                     SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

```

Results table 

```{r}

screenreg(list(didreg.forum.jew.not.peri, didreg.forum.jew.fe.not.peri, didreg.forum.jew.fe.vars.not.peri),
          custom.header = list("Jewish sector" = 1:3), include.ci = F, stars = c(.1, .05, .01), 
          custom.coef.names = c("Intercept", "Treat", "After", "Reform DiD", "Male indicator", "Mother's years of education", "Father's years of education",
                                "Number of siblings", "Native indicator", "SES index", "Class size", "School age"),
          digits = 3, custom.model.names = c("Model 1", "Model 2", "Model 3"))
```

### 9. General school satisfaction Indicator   

The General school satisfaction Indicator consists of the average of the answers to the following questions: 
**Q: "I feel good at school"** 
**Q: "I love being in school"**


DiD regression with clustered SE - Jewish sector

```{r}

didreg.feel_index.jew.not.peri <- lm_robust(feel_index ~ treat + after + did,
                            data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.feel_index.jew.fe.not.peri <- lm_robust(feel_index ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                             data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.feel_index.jew.fe.vars.not.peri <- lm_robust(feel_index ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                     SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

```

Results table 

```{r}

screenreg(list(didreg.feel_index.jew.not.peri, didreg.feel_index.jew.fe.not.peri, didreg.feel_index.jew.fe.vars.not.peri),
          custom.header = list("Jewish sector" = 1:3), include.ci = F, stars = c(.1, .05, .01), 
          custom.coef.names = c("Intercept", "Treat", "After", "Reform DiD", "Male indicator", "Mother's years of education", "Father's years of education",
                                "Number of siblings", "Native indicator", "SES index", "Class size", "School age"),
          digits = 3, custom.model.names = c("Model 1", "Model 2", "Model 3"))
```

### 10. Student misbehavior in class Indicator   

The Student misbehavior in class Indicator consists of the average of the answers to the following questions: 
**Q: "The students in my class treat teachers with respect"** 
**Q: "Students often make noise and commotion in the classroom and impair the learning of other students"**
**Q: "In my class there are students who are rude to teachers"** 
**Q: "Teachers have to wait a long time at the beginning of the lesson until the students stop making noise"** 



DiD regression with clustered SE - Jewish sector

```{r}

didreg.behave_index.jew.not.peri <- lm_robust(behave_index ~ treat + after + did,
                            data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.behave_index.jew.fe.not.peri <- lm_robust(behave_index ~ did, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                             data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

didreg.behave_index.jew.fe.vars.not.peri <- lm_robust(behave_index ~ did + CODE_MIN + SHNOT_LIMUD_EM + SHNOT_LIMUD_AV + MISPAR_ACHIM_TSAD_AV_EM + ERETS_LEDA +
                                     SES_index + TALMIDIM + SHNAT_YISUD, fixed_effects = ~CODE_MOSAD+SHNAT_LIMUD,
                                data = final_not_peri_jew, clusters = CODE_MOSAD, se_type = "stata")

```

Results table 

```{r}

screenreg(list(didreg.behave_index.jew.not.peri, didreg.behave_index.jew.fe.not.peri, didreg.behave_index.jew.fe.vars.not.peri),
          custom.header = list("Jewish sector" = 1:3), include.ci = F, stars = c(.1, .05, .01), 
          custom.coef.names = c("Intercept", "Treat", "After", "Reform DiD", "Male indicator", "Mother's years of education", "Father's years of education",
                                "Number of siblings", "Native indicator", "SES index", "Class size", "School age"),
          digits = 3, custom.model.names = c("Model 1", "Model 2", "Model 3"))
```